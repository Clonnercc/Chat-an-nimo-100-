<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Chat + Loja PIX</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:white;height:100vh;display:flex;flex-direction:column;}
header{background:#111;padding:10px;display:flex;justify-content:space-between;align-items:center;}
#menu{cursor:pointer;font-size:22px;}
#dropdown{display:none;position:absolute;right:10px;top:50px;background:#222;padding:10px;border-radius:5px;}
#chat{flex:1;overflow-y:auto;padding:15px;}
.msg{background:#1f1f1f;margin-bottom:8px;padding:8px;border-radius:6px;}
footer{display:flex;padding:10px;background:black;}
input{flex:1;padding:10px;}
button{padding:10px;background:#ff0055;color:white;border:none;margin-top:5px;cursor:pointer;}
.produto{border:1px solid #444;padding:10px;margin-top:10px;border-radius:6px;}
.pixbox{text-align:center;border:1px solid #555;padding:10px;margin-top:10px;}
img{max-width:220px;}
</style>
</head>
<body>

<header>
 <div>Chat + Loja</div>
 <div id="menu" onclick="toggle()">â‹®</div>
 <div id="dropdown">
   <div onclick="mostrarLoja()">ðŸ›’ Loja</div>
 </div>
</header>

<div id="chat"></div>

<footer>
<input id="txt" placeholder="Digite sua mensagem">
<button onclick="enviar()">Enviar</button>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const sala="publico";
socket.emit("joinRoom", sala);

const chat=document.getElementById("chat");
const txt=document.getElementById("txt");

const PIX = "d874698e-ba8a-492f-9cfc-b7f487aac459";
const WHATS = "https://wa.me/5516997410282?text=Comprei%205%20Mix%20Full";

function toggle(){
  const d=document.getElementById("dropdown");
  d.style.display=d.style.display==="none"?"block":"none";
}

function enviar(){
  if(!txt.value.trim()) return;
  socket.emit("msg",{room:sala,texto:txt.value});
  txt.value="";
}

socket.on("msg",d=>{
  const div=document.createElement("div");
  div.className="msg";
  div.innerHTML="<b>Anon-"+d.id+"</b>: "+d.texto;
  chat.appendChild(div);
});

socket.on("globalAlert",d=>{
  const div=document.createElement("div");
  div.className="msg";
  div.style.background="darkred";
  div.innerText="AVISO: "+d.texto;
  chat.appendChild(div);
});

window.produtos=[];

socket.on("produtos",lista=>{
  window.produtos=lista;
});

function mostrarLoja(){
  chat.innerHTML="<h3>ðŸ›’ LOJA</h3>";
  produtos.forEach(p=>{
    const div=document.createElement("div");
    div.className="produto";
    div.innerHTML=`
    <b>${p.nome}</b><br>
    Valor: R$${p.preco}

    <div class="pixbox">
      <p>Chave PIX:</p>
      <small>${PIX}</small><br><br>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${PIX}">
      <br><br>
      <button onclick="copiar()">Copiar Chave</button>
      <button onclick="jaPaguei()">âœ… JÃ¡ paguei</button>
    </div>
    `;
    chat.appendChild(div);
  });
}

function copiar(){
  navigator.clipboard.writeText(PIX);
  alert("Chave PIX copiada!");
}

function jaPaguei(){
  window.location.href = WHATS;
}
</script>

</body>
</html>
