<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Chat Anônimo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:white;display:flex;flex-direction:column;height:100vh;}
header{background:#111;padding:15px;text-align:center;font-size:18px;}
#online{color:#00ff99;font-size:13px;}
#chat{flex:1;overflow-y:auto;padding:15px;}
.msg{margin-bottom:8px;background:#1f1f1f;padding:8px;border-radius:6px;font-size:14px;}
footer{display:flex;gap:5px;background:#000;padding:10px;}
input{flex:1;padding:10px;border:none;border-radius:5px;}
button{background:#ff0055;border:none;color:white;border-radius:5px;padding:10px;}
small{font-size:11px;color:#777;text-align:center;padding:5px;}
</style>
</head>
<body>

<header>
  Sala: <span id="sala"></span> — <span id="online">0 online</span>
</header>

<div id="chat"></div>

<footer>
<input id="txt" placeholder="Mensagem..." autocomplete="off">
<button onclick="enviar()">Enviar</button>
<button onclick="limpar()">Limpar</button>
</footer>

<small>Mensagens temporárias — tudo apaga ao reiniciar</small>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// gera nome da sala pelo link
const sala = location.hash.replace("#","") || "publico";
document.getElementById("sala").innerText = sala;
socket.emit("joinRoom", sala);

const chat = document.getElementById("chat");
const txt = document.getElementById("txt");

function enviar(){
  if(txt.value.trim()=="") return;
  socket.emit("msg", { room: sala, texto: txt.value });
  txt.value="";
}

function limpar(){
  chat.innerHTML="";
}

socket.on("msg", (d)=>{
  const div = document.createElement("div");
  div.className="msg";
  div.innerHTML = `<b>Anon-${d.id}</b>: ${d.texto}`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;

  setTimeout(() => div.remove(), 60000); // 60 segundos
});

socket.on("online", (n)=>{
  document.getElementById("online").innerText = n + " online";
});

txt.addEventListener("keydown", e=>{
  if(e.key==="Enter") enviar();
});
socket.on("globalAlert", (d)=>{
  const div = document.createElement("div");
  div.className = "msg";
  div.style.background = "darkred";
  div.innerHTML = `<b>⚠️ AVISO GLOBAL</b><br>${d.texto}`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});
</script>

</body>
</html>
