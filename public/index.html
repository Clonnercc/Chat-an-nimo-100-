<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Chat + Loja</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:white;height:100vh;display:flex;flex-direction:column;}
header{background:#111;padding:10px;display:flex;justify-content:space-between;align-items:center;}
#menu{cursor:pointer;font-size:20px;}
#dropdown{display:none;position:absolute;right:10px;top:50px;background:#222;padding:10px;border-radius:5px;}
#chat{flex:1;overflow-y:auto;padding:15px;}
.msg{background:#1f1f1f;margin-bottom:8px;padding:8px;border-radius:6px;}
footer{display:flex;padding:10px;background:black;}
input{flex:1;padding:10px;}
button{padding:10px;background:#ff0055;color:white;border:none;}
.produto{border:1px solid #444;padding:8px;margin-top:5px;}
</style>
</head>
<body>

<header>
 <div>Chat + Loja</div>
 <div id="menu" onclick="toggle()">â‹®</div>
 <div id="dropdown">
   <div onclick="mostrarLoja()">ðŸ›’ Loja</div>
 </div>
</header>

<div id="chat"></div>

<footer>
<input id="txt">
<button onclick="enviar()">Enviar</button>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const sala="publico";
socket.emit("joinRoom", sala);

const chat=document.getElementById("chat");
const txt=document.getElementById("txt");

function toggle(){
  const d=document.getElementById("dropdown");
  d.style.display=d.style.display==="none"?"block":"none";
}

function enviar(){
  socket.emit("msg",{room:sala,texto:txt.value});
  txt.value="";
}

socket.on("msg",d=>{
  const div=document.createElement("div");
  div.className="msg";
  div.innerHTML="<b>Anon-"+d.id+"</b>: "+d.texto;
  chat.appendChild(div);
});

socket.on("globalAlert",d=>{
  const div=document.createElement("div");
  div.className="msg";
  div.style.background="darkred";
  div.innerText="AVISO: "+d.texto;
  chat.appendChild(div);
});

socket.on("produtos",lista=>{
  window.produtos=lista;
});

function mostrarLoja(){
  chat.innerHTML="<h3>LOJA</h3>";
  produtos.forEach(p=>{
    const div=document.createElement("div");
    div.className="produto";
    div.innerHTML=`
    ${p.nome} - R$${p.preco}
    <button onclick="comprar(${p.id})">Comprar</button>
    `;
    chat.appendChild(div);
  });
}

async function comprar(id){
  await fetch("/comprar",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({produtoId:id})
  });
  alert("Pedido enviado");
}
</script>

</body>
</html>
